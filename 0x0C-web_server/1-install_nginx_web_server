#!/usr/bin/env bash
# This script installs and configures nginx on an Ubuntu machine.

# Update package list and install nginx with -y option
sudo apt-get update
sudo apt-get install -y nginx

# Ensure nginx is listening on port 80
sudo sed -i '/listen 80 default_server;/c\listen 80;' /etc/nginx/sites-available/default

# Restart nginx without using systemctl
sudo service nginx restart

# Verify nginx is running
if sudo service nginx status | grep -q "Active: active"; then
    echo "Nginx is running and listening on port 80."
else
    echo "Error: Nginx is not running as expected."
fi

# Create a sample HTML page with "Hello World!"
echo "<html><body><h1>Hello World!</h1></body></html>" | sudo tee /var/www/html/index.html > /dev/null

# Wait for nginx to fully restart (adjust sleep duration if needed)
sleep 2

# Verify Nginx returns "Hello World!" for a GET request
curl_output=$(curl -s http://localhost)
if [[ "$curl_output" == *"<h1>Hello World!</h1>"* ]]; then
    echo "Nginx returns 'Hello World!' as expected."
else
    echo "Error: Nginx did not return 'Hello World!' as expected."
fi
